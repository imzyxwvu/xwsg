<!DOCTYPE html>
<html>
<head>
    <title>IOMaster Console</title>
    <style>
        .block-container {
            line-height: 0;
        }
        .block {
            margin: 1px 1px;
            border: solid 1px darkcyan;
            background-color: white;
            height: 10px;
            width: 10px;
            display: inline-block;
            box-sizing: border-box;
        }
        .speed-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 30px;
            text-align: center;
            border-bottom: solid 1px darkgray;
            font-color: darkgray;
            background-color: rgba(255, 255, 255, .8);
        }
        .speed-indicator span {
            color: orangered;
            font-weight: bold;
        }
        body {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="speed-indicator">READ <span id="readSpeed">? MBps</span> WRITE <span id="writeSpeed">? MBps</span></div>
    <div class="block-container" id="blockContainer"></div>
    <script>
        var ws = new WebSocket("ws://" + document.location.host + "/connect");
        var blockElements = [];
        var blockStatus = [];
        ws.onmessage = function(e) {
            var obj = JSON.parse(e.data);
            if(obj.block_count) {
                for(var i = 0; i < obj.block_count; i++) {
                    var bel = document.createElement("div");
                    bel.className = "block";
                    blockElements.push(bel);
                    blockStatus.push(0);
                    blockContainer.appendChild(bel);
                }
            }
            if(obj.read !== undefined) {
                readSpeed.innerText = obj.read + " MBps";
            }
            if(obj.write !== undefined) {
                writeSpeed.innerText = obj.write + " MBps";
            }
            if(obj.heatmap) {
                for(var blkNo in obj.heatmap) {
                    blockStatus[blkNo] += obj.heatmap[blkNo];
                }
            }
        }
        setInterval(function() {
            for(var i = 0; i < blockStatus.length; i++) {
                var bel = blockElements[i];
                bel.style.backgroundColor = "rgb(255," + (255 - blockStatus[i]) + "," + (255 - blockStatus[i]) + ")";
                blockStatus[i] -= 10;
                if(blockStatus[i] < 0)
                    blockStatus[i] = 0;
            }
        }, 100);
    </script>
</body>
</html>